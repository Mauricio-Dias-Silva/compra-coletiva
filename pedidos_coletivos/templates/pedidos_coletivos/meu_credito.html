{# pedidos_coletivos/templates/pedidos_coletivos/meu_credito.html #}
{% extends 'base.html' %}

{% block titulo_pagina %}{{ titulo_pagina }}{% endblock titulo_pagina %}

{% block conteudo %}
<h1 class="my-4 text-center">{{ titulo_pagina }}</h1>

<div class="row mb-4">
    <!-- Card de Saldo -->
    <div class="col-md-6 mb-3 mb-md-0">
        <div class="card shadow-sm h-100 border-primary">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0"><i class="bi bi-wallet2"></i> Saldo Atual</h4>
            </div>
            <div class="card-body text-center d-flex flex-column justify-content-center">
                <p class="display-4 fw-bold text-success mb-0">R$ {{ credito_usuario.saldo|floatformat:2 }}</p>
                <p class="text-muted mt-2">Use seus cr√©ditos para comprar qualquer oferta.</p>
            </div>
        </div>
    </div>

    <!-- Card de Indica√ß√£o (Gamification) -->
    <div class="col-md-6">
        <div class="card shadow-sm h-100 border-warning">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0"><i class="bi bi-gift-fill"></i> Indique e Ganhe!</h4>
            </div>
            <div class="card-body text-center">
                <p>Ganhe <strong>2% de volta</strong> em cr√©ditos toda vez que um amigo comprar usando seu c√≥digo!</p>

                <div class="bg-light p-3 rounded mb-3 border">
                    <span class="text-muted text-uppercase small">Seu C√≥digo de Indica√ß√£o:</span>
                    <h3 class="fw-bold text-primary mb-0" id="referralCode">{{
                        user.codigo_indicacao|default:"GERE-1-COMPRA" }}</h3>
                </div>

                {% if user.codigo_indicacao %}
                <a href="https://wa.me/?text=üéÅ Ol√°! Use meu c√≥digo *{{ user.codigo_indicacao }}* no VarejoUnido e aproveite ofertas incr√≠veis de caixa fechada! üõí {{ request.build_absolute_uri|slice:':-13' }}"
                    target="_blank" class="btn btn-success w-100 fw-bold">
                    <i class="bi bi-whatsapp"></i> Enviar no Zap
                </a>
                {% else %}
                <p class="text-danger small">Fa√ßa sua primeira compra para gerar seu c√≥digo!</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card shadow-sm">
    <div class="card-header bg-info text-white">
        <h4 class="mb-0">Hist√≥rico de Transa√ß√µes de Cr√©dito</h4>
    </div>
    <div class="card-body">
        {% if historico %}
        <div class="table-responsive">
            <table class="table table-striped table-hover">
                <thead>
                    <tr>
                        <th>Data</th>
                        <th>Tipo</th>
                        <th>Valor</th>
                        <th>Descri√ß√£o</th>
                        <th>Saldo Ap√≥s</th>
                    </tr>
                </thead>
                <tbody>
                    {% for transacao in historico %}
                    <tr>
                        <td>{{ transacao.data_transacao|date:"d/m/Y H:i" }}</td>
                        <td>
                            {% if transacao.tipo_transacao == 'entrada' %}
                            <span class="badge bg-success">{{ transacao.get_tipo_transacao_display }}</span>
                            {% else %}
                            <span class="badge bg-danger">{{ transacao.get_tipo_transacao_display }}</span>
                            {% endif %}
                        </td>
                        <td>R$ {{ transacao.valor|floatformat:2 }}</td>
                        <td>{{ transacao.descricao|default:"-" }}</td>
                        <td>R$ {{ transacao.saldo_apos_transacao|floatformat:2 }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="alert alert-secondary text-center" role="alert">
            Voc√™ ainda n√£o possui hist√≥rico de transa√ß√µes de cr√©dito.
        </div>
        {% endif %}
    </div>
</div>
{% endblock conteudo %}